<!DOCTYPE html>
<html>
<head>
	
	<title>Highland Park Yardsale Map - BETA</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.4.7/dialog-polyfill.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.cyan-light_green.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.4.7/dialog-polyfill.min.css" type="text/css">

	
</head>
<body>
    <dialog class="mdl-dialog">
        <h4 class="mdl-dialog__title">Highland Park Yardsale Map</h4>
        <div class="mdl-dialog__content">
            <p><strong>BETA</strong></p>
            <p>Welcome to the online Highland Park Yard Sale Map for 2017! Don't plan based on this map yet! Address numbers and detailed map locations will be revealed on <strong>June 4th at 8:30 am</strong>.</p>
            <p>Additionally, this site is still in beta and may have some missing or broken functionality.</p>
        </div>
        <div class="mdl-dialog__actions">
            <button type="button" class="mdl-button close">Show me the listings!</button>
        </div>
    </dialog>
    <script>
        var dialog = document.querySelector('dialog');
        dialogPolyfill.registerDialog(dialog);
        dialog.querySelector('button:not([disabled])').addEventListener('click', function() { dialog.close();});
        dialog.showModal();
    </script>
            
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
                mdl-layout--fixed-tabs
                mdl-layout--no-drawer-button
                mdl-layout--no-desktop-drawer-button">

        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">The 2017 Highland Park Yard Sale</span>
            </div>
            <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
                <a href="#list-tab" class="mdl-layout__tab is-active"><strong>List View</strong></a>
                <a href="#map-tab" class="mdl-layout__tab"><strong>Map View</strong></a>
            </div>
        </header>
  <!--<div class="mdl-layout__drawer">
    <span class="mdl-layout-title">Title</span>
  </div>-->
    <main class="mdl-layout__content">
        <section class="mdl-layout__tab-panel is-active" id="list-tab">
            <div class="page-content">
            <ul class="mdl-list">
            {%for location in locations%}
                {% if location.lat and location.lon %}
                    <li class="mdl-list__item mdl-list__item--three-line">
                    <span class="mdl-list__item-primary-content">
                    <a id="marker_{{loop.index}}" href="#">
                        <span class="mdl-chip mdl-chip--contact">
                            <span class="mdl-chip__contact mdl-color--cyan mdl-color-text--white">{{loop.index}}</span>
                            <span class="mdl-chip__text">{{location.address}}</span>
                        </span>
                    </a>
                        <span class="mdl-list__item-text-body">
                            {{location.stuff}}
                        </span>
                    </span>
                    </li>
                 {%endif%}
             {%endfor%}
             </ul>
             </div>
        </section>
        <section class="mdl-layout__tab-panel" id="map-tab">
            <div class="page-content">
                <div id="mapid" style="height: 100vh; width: 100vw;"></div>
            </div>
        </section>
    </main>
    </div>



    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script>

    var mymap = L.map('mapid').setView({{highland_park_center}}, 14);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoianl1bmR0IiwiYSI6ImNqMGc3M2Z1MzAyOWQzMnB1MmJ3YTZqa3cifQ.xcu0DyUJaUf2VIoXvyAyNA', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

    var markers = [];
    {%for location in locations%}
        {% if location.lat and location.lon %}
            var marker_{{loop.index}} = L.marker([{{location.lat}}, {{location.lon}}],{title:"marker_{{loop.index}}"}).addTo(mymap).bindPopup('<strong>{{location.address}}</strong><br>{{location.stuff}}');
            markers.push(marker_{{loop.index}});
        {%endif%}
    {%endfor%}

    function onLocationFound(e) {
        var radius = e.accuracy / 2;
        var location = e.latlng
        L.circle(location, radius).addTo(mymap);
    }

    function onLocationError(e) {
        alert(e.message);
    }

    function markerPopupOnClick(id){
        for (var i in markers){
            var markerID = markers[i].options.title;
            if (markerID == id){
                $(".mdl-layout__tab:eq(1) span").click ();
                $("#mapid").height($("main.mdl-layout__content").height()); mymap.invalidateSize();
                markers[i].openPopup();
            };
        }
    }


    mymap.on('locationfound', onLocationFound);
    mymap.on('locationerror', onLocationError);

    mymap.locate({setView: true, maxZoom: 16});
      
    $("a").click(function(){
        markerPopupOnClick($(this)[0].id);
    });

    $(window).on("resize", function () { $("#mapid").height($("main.mdl-layout__content").height()); mymap.invalidateSize(); }).trigger("resize");



</script>
   



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-100160098-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>

