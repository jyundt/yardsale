<!DOCTYPE html>
<html>
<head>
	
	<title>Highland Park Yardsale Map</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.cyan-light_green.min.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">


	
</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
                mdl-layout--fixed-tabs">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">The 2017 Highland Park Yard Sale</span>
            </div>
            <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
                <a href="#list-tab" class="mdl-layout__tab is-active"><strong>List View</strong></a>
                <a href="#map-tab" class="mdl-layout__tab"><strong>Map View</strong></a>
            </div>
        </header>
  <!--<div class="mdl-layout__drawer">
    <span class="mdl-layout-title">Title</span>
  </div>-->
    <main class="mdl-layout__content">
        <section class="mdl-layout__tab-panel is-active" id="list-tab">
            <div class="page-content">
            <ul class="mdl-list">
            {%for location in locations%}
                <li class="mdl-list__item mdl-list__item--three-line">
                <span class="mdl-list__item-primary-content">
                <a id="marker_{{loop.index}}" href="#">
                    <span class="mdl-chip mdl-chip--contact">
                        <span class="mdl-chip__contact mdl-color--cyan mdl-color-text--white">{{loop.index}}</span>
                        <span class="mdl-chip__text">{{location.address}}</span>
                    </span>
                </a>
                    <span class="mdl-list__item-text-body">
                        {{location.stuff}}
                    </span>
                </span>
                </li>
             {%endfor%}
             </ul>
             </div>
        </section>
        <section class="mdl-layout__tab-panel" id="map-tab">
            <div class="page-content">
                <div id="mapid" style="height: 100vh; width: 100vw;"></div>
            </div>
        </section>
    </main>
    </div>



    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script>

	var mymap = L.map('mapid').setView({{highland_park_center}}, 14);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoianl1bmR0IiwiYSI6ImNqMGc3M2Z1MzAyOWQzMnB1MmJ3YTZqa3cifQ.xcu0DyUJaUf2VIoXvyAyNA', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

    var markers = [];
    {%for location in locations%}
        var marker_{{loop.index}} = L.marker([{{location.lat}}, {{location.lon}}],{title:"marker_{{loop.index}}"}).addTo(mymap).bindPopup('<strong>{{location.address}}</strong><br>{{location.stuff}}');
        markers.push(marker_{{loop.index}});
    {%endfor%}

      function onLocationFound(e) {
         var radius = e.accuracy / 2;
         var location = e.latlng
         L.circle(location, radius).addTo(mymap);
      }

      function onLocationError(e) {
         alert(e.message);
      }

      function markerPopupOnClick(id){
          for (var i in markers){
              var markerID = markers[i].options.title;
              if (markerID == id){
                  $(".mdl-layout__tab:eq(1) span").click ();
                  markers[i].openPopup();
              };
          }
      }


      mymap.on('locationfound', onLocationFound);
      mymap.on('locationerror', onLocationError);

      mymap.locate({setView: true, maxZoom: 16});
      
      $("a").click(function(){
          markerPopupOnClick($(this)[0].id);
      });

</script>
   



</body>
</html>

